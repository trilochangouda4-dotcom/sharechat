<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini WhatsApp</title>
<style>
/* ===== CSS ===== */
body {margin:0;font-family:Arial,sans-serif;background:#ECE5DD;}
.app-container {display:flex;flex-direction:column;height:100vh;}
.contact-list {display:flex;overflow-x:auto;background:#075E54;padding:5px;}
.contact-item {color:white;margin-right:10px;text-align:center;cursor:pointer;}
.contact-item img {width:40px;border-radius:50%;display:block;margin:0 auto 2px;}
.chat-header {background:#128C7E;color:white;padding:10px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #075E54;}
.chat-header img {width:40px;border-radius:50%;}
.chat-messages {flex:1;padding:10px;overflow-y:auto;display:flex;flex-direction:column;}
.message {padding:10px;margin:5px;max-width:70%;border-radius:15px;position:relative;word-wrap:break-word;}
.message .time {font-size:0.7em;color:#555;position:absolute;bottom:3px;right:10px;}
.sent {background:#DCF8C6;align-self:flex-end;border-bottom-right-radius:0;}
.received {background:white;align-self:flex-start;border-bottom-left-radius:0;}
.chat-input {display:flex;padding:5px;background:#f0f0f0;border-top:1px solid #ccc;}
.chat-input input[type=text] {flex:1;padding:10px;border-radius:20px;border:1px solid #ccc;}
.chat-input input[type=file] {margin-left:5px;}
.chat-input button {padding:10px;background:#128C7E;color:white;border:none;margin-left:5px;border-radius:20px;cursor:pointer;}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
</head>
<body>

<div class="contact-list" id="contacts"></div>
<div class="chat-header">
  <div id="chat-name">Select a chat</div>
  <img id="chat-pic" src="https://via.placeholder.com/40">
</div>
<div class="chat-messages" id="messages"></div>
<div class="chat-input">
  <input type="text" id="messageInput" placeholder="Type a message...">
  <input type="file" id="fileInput">
  <button id="sendBtn">Send</button>
</div>

<script>
// ===== Firebase Config =====
const firebaseConfig = {
  apiKey: "AIzaSyBxY0do9AYlt9NSHEA0jvUAHhKiOhnctt0",
  authDomain: "chatbot-bd1b4.firebaseapp.com",
  projectId: "chatbot-bd1b4",
  storageBucket: "chatbot-bd1b4.firebasestorage.app",
  messagingSenderId: "178313205826",
  appId: "1:178313205826:web:e4622b7f328e541ea775db",
  measurementId: "G-Q217QD5HH9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

// ===== User Setup =====
let username = prompt("Enter your username:");
let userPic = prompt("Enter profile picture URL (optional)","https://via.placeholder.com/40");
if(!username) username="User";

const contacts = [
  {name:'Alice',pic:'https://via.placeholder.com/40?text=A'},
  {name:'Bob',pic:'https://via.placeholder.com/40?text=B'},
  {name:'Charlie',pic:'https://via.placeholder.com/40?text=C'}
];

let currentChat = null;

// ===== Load Contacts =====
const contactsDiv = document.getElementById('contacts');
contacts.forEach(c=>{
  const div=document.createElement('div');
  div.classList.add('contact-item');
  div.innerHTML=`<img src="${c.pic}"><div>${c.name}</div>`;
  div.addEventListener('click',()=>openChat(c));
  contactsDiv.appendChild(div);
});

// ===== Open Chat =====
function openChat(contact){
  currentChat=contact;
  document.getElementById('chat-name').textContent=contact.name;
  document.getElementById('chat-pic').src=contact.pic;
  document.getElementById('messages').innerHTML='';
  
  if(window.currentChatRef) window.currentChatRef.off();

  const chatId = getChatId(username, contact.name);
  window.currentChatRef=db.ref('chats/'+chatId);
  
  window.currentChatRef.on('child_added', snapshot=>{
    const msg=snapshot.val();
    displayMessage(msg.sender,msg.text,msg.fileUrl,msg.timestamp);
  });
}

function getChatId(u1,u2){
  return [u1,u2].sort().join('_');
}

// ===== Send Message =====
const input=document.getElementById('messageInput');
const sendBtn=document.getElementById('sendBtn');
const fileInput=document.getElementById('fileInput');

sendBtn.addEventListener('click',sendMessage);
input.addEventListener('keypress',(e)=>{if(e.key==='Enter') sendMessage();});

function sendMessage(){
  if(!currentChat) return;
  const text=input.value.trim();
  const file=fileInput.files[0];
  const chatId=getChatId(username,currentChat.name);

  if(file){
    const storageRef=storage.ref('files/'+Date.now()+'_'+file.name);
    storageRef.put(file).then(snap=>snap.ref.getDownloadURL().then(url=>{
      db.ref('chats/'+chatId).push({sender:username,text:text,fileUrl:url,timestamp:Date.now()});
    }));
  }else if(text){
    db.ref('chats/'+chatId).push({sender:username,text:text,timestamp:Date.now()});
  }
  input.value='';
  fileInput.value='';
}

// ===== Display Messages =====
function displayMessage(sender,text,fileUrl,timestamp){
  const msgDiv=document.createElement('div');
  msgDiv.classList.add('message');
  msgDiv.classList.add(sender===username?'sent':'received');
  
  let timeStr = timestamp ? new Date(timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '';
  
  if(fileUrl){
    msgDiv.innerHTML=`${text}<br><a href="${fileUrl}" target="_blank">ðŸ“Ž View File</a><div class="time">${timeStr}</div>`;
  }else{
    msgDiv.innerHTML=`${text}<div class="time">${timeStr}</div>`;
  }
  
  document.getElementById('messages').appendChild(msgDiv);
  document.getElementById('messages').scrollTop=document.getElementById('messages').scrollHeight;
}
</script>

</body>
</html>
